SPRINT 2 - PERFORMANCE CRITICAL: IMPLEMENTATION GUIDE

FRONTEND FILES TO MODIFY:
========================

1. VotersTable Component
   Location: E:\GitHub\e-voting\src\components\VotersTable.jsx
   Lines 5-427
   
   Issues:
   - Line 30: No pagination parameters in GET request
   - Lines 19-26: Client-side search (move to server)
   - Lines 40-74: Client-side sorting (move to server)
   - No pagination state management
   - Line 93: Calls undefined PUT endpoint
   
   Changes:
   - Add pagination state (page, pageSize, total, totalPages)
   - Add search/filter/sort state
   - Modify fetchVoters() to include query parameters
   - Add pagination controls UI
   - Move filtering/sorting to server-side

2. ElectionDetails Page
   Location: E:\GitHub\e-voting\src\pages\ElectionDetails.jsx
   Line 52-59: fetchVoters() call
   
   Changes:
   - Pass pagination props to VotersTable
   - Handle pagination state

3. AddVotersModal Component  
   Location: E:\GitHub\e-voting\src\components\AddVotersModal.jsx
   Status: Frontend OK, backend needs optimization

BACKEND FILES TO MODIFY:
=======================

1. Voters Routes (CRITICAL)
   Location: E:\GitHub\e-voting\server\routes\voters.js
   
   GET /elections/:electionId/voters (Lines 205-227)
   Current Query:
   SELECT id, email, name, weight, has_voted, voted_at, reminder_sent, last_reminder_at, created_at
   FROM voters
   WHERE election_id = ?
   ORDER BY created_at DESC
   
   ISSUE: No LIMIT/OFFSET, fetches ALL voters
   
   FIX:
   - Add query parameters: limit, offset, page, search, sort
   - Add LIMIT and OFFSET to query
   - Add WHERE clause for search (email LIKE or name LIKE)
   - Add ORDER BY with sort parameters
   - Return pagination metadata
   
   POST /elections/:electionId/voters (Lines 19-95)
   ISSUE: N+1 inserts (line 49)
   FIX: Implement batch INSERT instead of loop
   
   POST /elections/:electionId/voters/import (Lines 100-200)
   ISSUE: N+1 inserts (line 145)
   FIX: Implement batch INSERT for CSV records
   
   POST /elections/:electionId/voters/send-emails (Lines 232-277)
   ISSUE: SELECT *, N updates, N emails
   FIX: Select only needed fields, batch QR generation
   
   DELETE /elections/:electionId/voters/:voterId (Lines 282-303)
   Status: OK, single operation

   MISSING: PUT /elections/:electionId/voters/:voterId
   ACTION: Implement voter edit endpoint

2. Database Schema (CRITICAL)
   Location: E:\GitHub\e-voting\server\database\schema.js
   Lines 160-168
   
   Current Indexes:
   - idx_voters_election (election_id)
   - idx_voters_token (token)
   
   MISSING INDEXES (Add after line 168):
   - idx_voters_email (for search)
   - idx_voters_has_voted (for filtering)
   - idx_voters_election_voted (composite)
   - idx_public_votes_election (on public_votes table)

3. Elections Routes (SECONDARY)
   Location: E:\GitHub\e-voting\server\routes\elections.js
   Lines 107-116
   
   OPTIMIZATION: Denormalize voter counts (Phase 2)

4. Results Routes  
   Location: E:\GitHub\e-voting\server\routes\results.js
   
   ACTION: Add idx_public_votes_election index
   No pagination needed (results typically small)

5. Reminders Routes
   Location: E:\GitHub\e-voting\server\routes\reminders.js
   Lines 29-32
   
   FIX: Select only needed fields (email, id, name)
   FIX: Consider batch email sending

IMPLEMENTATION PHASES:
=====================

PHASE 1: Critical (Pagination Core)
- Voters GET endpoint: Add limit/offset/search/sort
- VotersTable: Pagination UI and state
- Schema: Add missing indexes

PHASE 2: Important (Batch Operations)  
- Voters POST: Batch INSERT for manual add
- Voters POST import: Batch INSERT for CSV
- Voters PUT: Implement edit endpoint

PHASE 3: Optimization (Bulk Operations)
- Send emails: Optimize with batch QR generation
- Reminders: Batch email sending
- Elections: Optimize aggregations

KEY METRICS:
============

Before (Current):
- Load 10K voters: 500+ ms
- Search per keystroke: 100+ ms
- Add 100 voters: 5000+ ms
- Send 10K emails: 30+ seconds
- Database indexes: 2

After (Sprint 2):
- Load page 1 (50 rows): 50 ms  
- Search per keystroke: <10 ms
- Add 100 voters: <100 ms
- Send 10K emails: <5 seconds
- Database indexes: 6

Improvement: 85-95% faster operations

PAGINATION RESPONSE FORMAT:
==========================

{
  voters: [{
    id: string,
    email: string,
    name: string,
    weight: number,
    has_voted: boolean,
    created_at: string
  }],
  pagination: {
    page: number,
    pageSize: number,
    total: number,
    totalPages: number,
    hasNextPage: boolean,
    hasPreviousPage: boolean
  }
}

QUERY PARAMETER FORMAT:
======================

GET /elections/{electionId}/voters?page=1&limit=50&search=john&sort=email&direction=asc

Parameters:
- page: Number (default 1)
- limit: Number (default 50, max 100)
- search: String (optional, searches email and name)
- sort: String (email, name, weight, has_voted, created_at)
- direction: String (asc or desc)

END OF GUIDE
